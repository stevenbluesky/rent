<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.rent.dao.SubsidyMapper" >
  <resultMap id="BaseResultMap" type="com.rent.entity.Subsidy" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed May 03 17:21:11 CST 2017.
    -->
    <id column="ID" property="id" jdbcType="DECIMAL" />
    <result column="BEGIN_DATE" property="beginDate" jdbcType="DATE" />
    <result column="END_DATE" property="endDate" jdbcType="DATE" />
    <result column="PER_ONE_AREA" property="perOneArea" jdbcType="DECIMAL" />
    <result column="MIN_SAFE_AREA" property="minSafeArea" jdbcType="DECIMAL" />
    <result column="MAX_SAFE_AREA" property="maxSafeArea" jdbcType="DECIMAL" />
    <result column="MAX_AREA" property="maxArea" jdbcType="DECIMAL" />
    <result column="Price" property="price" jdbcType="DECIMAL" />
    
    <result column="IN_PERCENT_ID" property="inPercentId" jdbcType="DECIMAL" />
    <result column="OUT_PERCENT_ID" property="outPercentId" jdbcType="DECIMAL" />
    <result column="ESTATE_ID" property="estateId" jdbcType="DECIMAL" />
    <result column="UPDATE_TIME" property="updateTime" jdbcType="DATE" />
    <result column="UPDATE_USER" property="updateUser" jdbcType="DECIMAL" />
    <!-- <result column="subsidy_Type_Id" property="subsidyTypeId" jdbcType="DECIMAL" /> -->
    
  </resultMap>
  
  <!-- 计算补贴的实体类 -->
  <resultMap id="subsidyCalResultMap" type="com.rent.services.impl.SubsidyCal" >
  	<result column="per_one_area" property="perOneArea" jdbcType="DECIMAL" />
  	<result column="min_safe_area" property="minSafeArea" jdbcType="DECIMAL" />
  	<result column="max_safe_area" property="maxSafeArea" jdbcType="DECIMAL" />
  	<result column="max_area" property="maxArea" jdbcType="DECIMAL" />
  	<result column="price" property="unitPrice" jdbcType="DECIMAL" />
  	<result column="percent" property="percent" jdbcType="DECIMAL" /> 
  </resultMap>

  <sql id="Base_Column_List" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed May 03 17:21:11 CST 2017.
    -->
    ID, BEGIN_DATE, END_DATE, PER_ONE_AREA, MIN_SAFE_AREA, MAX_SAFE_AREA, MAX_AREA,PRICE, 
    IN_PERCENT_ID, OUT_PERCENT_ID, ESTATE_ID, UPDATE_TIME, UPDATE_USER
    <!-- ,subsidy_Type_Id -->
  </sql>
  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.Integer" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed May 03 17:21:11 CST 2017.
    -->
    select 
    <include refid="Base_Column_List" />
    from SUBSIDY
    where ID = #{id,jdbcType=DECIMAL}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed May 03 17:21:11 CST 2017.
    -->
    delete from SUBSIDY
    where ID = #{id,jdbcType=DECIMAL}
  </delete>
  <insert id="insert" parameterType="com.rent.entity.Subsidy" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed May 03 17:21:11 CST 2017.
    -->
    insert into SUBSIDY (BEGIN_DATE, END_DATE,
      PER_ONE_AREA, MIN_SAFE_AREA, MAX_SAFE_AREA, 
      MAX_AREA,PRICE, IN_PERCENT_ID, OUT_PERCENT_ID, 
      ESTATE_ID, UPDATE_TIME, UPDATE_USER
      )
    values (#{beginDate,jdbcType=DATE}, #{endDate,jdbcType=DATE},
      #{perOneArea,jdbcType=DECIMAL}, #{minSafeArea,jdbcType=DECIMAL}, #{maxSafeArea,jdbcType=DECIMAL}, 
      #{maxArea,jdbcType=DECIMAL}, #{price,jdbcType=DECIMAL},
       #{inPercentId,jdbcType=DECIMAL}, #{outPercentId,jdbcType=DECIMAL}, 
      #{estateId,jdbcType=DECIMAL}, #{updateTime,jdbcType=DATE}, #{updateUser,jdbcType=DECIMAL}
      
      )
  </insert>
  <insert id="insertSelective" parameterType="com.rent.entity.Subsidy" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed May 03 17:21:11 CST 2017.
    -->
    insert into SUBSIDY
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        ID,
      </if>
      <if test="beginDate != null" >
        BEGIN_DATE,
      </if>
      <if test="endDate != null" >
        END_DATE,
      </if>
      <if test="perOneArea != null" >
        PER_ONE_AREA,
      </if>
      <if test="minSafeArea != null" >
        MIN_SAFE_AREA,
      </if>
      <if test="maxSafeArea != null" >
        MAX_SAFE_AREA,
      </if>
      <if test="maxAreaPrice != null" >
        MAX_AREA_PRICE,
      </if>
      <if test="inPercentId != null" >
        IN_PERCENT_ID,
      </if>
      <if test="outPercentId != null" >
        OUT_PERCENT_ID,
      </if>
      <if test="estateId != null" >
        ESTATE_ID,
      </if>
      <if test="updateTime != null" >
        UPDATE_TIME,
      </if>
      <if test="updateUser != null" >
        UPDATE_USER,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        #{id,jdbcType=DECIMAL},
      </if>
      <if test="beginDate != null" >
        #{beginDate,jdbcType=DATE},
      </if>
      <if test="endDate != null" >
        #{endDate,jdbcType=DATE},
      </if>
      <if test="perOneArea != null" >
        #{perOneArea,jdbcType=DECIMAL},
      </if>
      <if test="minSafeArea != null" >
        #{minSafeArea,jdbcType=DECIMAL},
      </if>
      <if test="maxSafeArea != null" >
        #{maxSafeArea,jdbcType=DECIMAL},
      </if>
      <if test="maxAreaPrice != null" >
        #{maxAreaPrice,jdbcType=DECIMAL},
      </if>
      <if test="inPercentId != null" >
        #{inPercentId,jdbcType=DECIMAL},
      </if>
      <if test="outPercentId != null" >
        #{outPercentId,jdbcType=DECIMAL},
      </if>
      <if test="estateId != null" >
        #{estateId,jdbcType=DECIMAL},
      </if>
      <if test="updateTime != null" >
        #{updateTime,jdbcType=DATE},
      </if>
      <if test="updateUser != null" >
        #{updateUser,jdbcType=DECIMAL},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.rent.entity.Subsidy" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed May 03 17:21:11 CST 2017.
    -->
    update SUBSIDY
    <set >
      <if test="beginDate != null" >
        BEGIN_DATE = #{beginDate,jdbcType=DATE},
      </if>
      <if test="endDate != null" >
        END_DATE = #{endDate,jdbcType=DATE},
      </if>
      <if test="perOneArea != null" >
        PER_ONE_AREA = #{perOneArea,jdbcType=DECIMAL},
      </if>
      <if test="minSafeArea != null" >
        MIN_SAFE_AREA = #{minSafeArea,jdbcType=DECIMAL},
      </if>
      <if test="maxSafeArea != null" >
        MAX_SAFE_AREA = #{maxSafeArea,jdbcType=DECIMAL},
      </if>
      <if test="maxAreaPrice != null" >
        MAX_AREA_PRICE = #{maxAreaPrice,jdbcType=DECIMAL},
      </if>
      <if test="inPercentId != null" >
        IN_PERCENT_ID = #{inPercentId,jdbcType=DECIMAL},
      </if>
      <if test="outPercentId != null" >
        OUT_PERCENT_ID = #{outPercentId,jdbcType=DECIMAL},
      </if>
      <if test="estateId != null" >
        ESTATE_ID = #{estateId,jdbcType=DECIMAL},
      </if>
      <if test="updateTime != null" >
        UPDATE_TIME = #{updateTime,jdbcType=DATE},
      </if>
      <if test="updateUser != null" >
        UPDATE_USER = #{updateUser,jdbcType=DECIMAL},
      </if>
    </set>
    where ID = #{id,jdbcType=DECIMAL}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.rent.entity.Subsidy" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed May 03 17:21:11 CST 2017.
    -->
    update SUBSIDY
    set BEGIN_DATE = #{beginDate,jdbcType=DATE},
      END_DATE = #{endDate,jdbcType=DATE},
      PER_ONE_AREA = #{perOneArea,jdbcType=DECIMAL},
      MIN_SAFE_AREA = #{minSafeArea,jdbcType=DECIMAL},
      MAX_SAFE_AREA = #{maxSafeArea,jdbcType=DECIMAL},
      MAX_AREA = #{maxArea,jdbcType=DECIMAL},
      price= #{price,jdbcType=DECIMAL},
      IN_PERCENT_ID = #{inPercentId,jdbcType=DECIMAL},
      OUT_PERCENT_ID = #{outPercentId,jdbcType=DECIMAL},
      ESTATE_ID = #{estateId,jdbcType=DECIMAL},
      UPDATE_TIME = #{updateTime,jdbcType=DATE},
      UPDATE_USER = #{updateUser,jdbcType=DECIMAL}
    
      
    where ID = #{id,jdbcType=DECIMAL}
  </update>
  
  	<!--分页查询  -->
  <select id="findByEstatePaged" resultMap="BaseResultMap" parameterType="java.lang.Integer" >
		    SELECT * FROM SUBSIDY where estate_id=#{0}
		     order by begin_date desc
		limit #{1} , #{2}
	</select>
  
  
  	<!--查询总数  -->
   <select id="getCountByEstate" resultType="java.lang.Integer" >
    select 
    	count(*)
    from SUBSIDY where estate_id=#{0}
  </select>
  
  
   <select id="getCurrId" resultType="java.lang.Integer" >
   		/*select seq_subsidy.currval from dual*/
   		/*SELECT LAST_INSERT_ID() from SUBSIDY group by `LAST_INSERT_ID()`*/
   		SELECT id  FROM SUBSIDY ORDER BY id DESC LIMIT 1
  </select>
	<!-- 查询要计算的补贴  -->
			    
	 <select id="findSubsidyCal" resultMap="subsidyCalResultMap"  >
		select  s.per_one_area per_one_area,
		        s.min_safe_area min_safe_area, 
	               s.max_safe_area max_safe_area,
	               s.max_area max_area, 
	               s.price price,
	               w.percent percent
	       from  SUBSIDY_WITH_TYPE w ,SUBSIDY s
		where s.id=w.subsidy_id 
		      and s.estate_id=#{0}  and  w.type_id=#{1} 
			  and begin_date &lt;= #{3} and  end_date>=#{3}
			  and w.in_or_out=#{2}
	</select> 

	
</mapper>